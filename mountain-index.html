<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üèî Mountain Quest - Index</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Quicksand:wght@500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        background: url("https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1920&q=80")
          no-repeat center center/cover;
        font-family: "Quicksand", sans-serif;
        color: #f0fdf4;
        overflow-x: hidden;
      }
      .overlay {
        position: fixed;
        inset: 0;
        background: linear-gradient(
          180deg,
          rgba(7, 31, 22, 0.85) 0%,
          rgba(34, 197, 94, 0.12) 100%
        );
        backdrop-filter: blur(3px);
        z-index: 0;
      }
      .title {
        font-family: "Press Start 2P", cursive;
        text-shadow: 0 0 18px #34d399, 0 2px 24px #0b4a3e;
        letter-spacing: 2px;
      }
      .card {
        background: rgba(6, 78, 59, 0.92);
        border: 2px solid rgba(34, 197, 94, 0.5);
        border-radius: 1.2rem;
        padding: 1.5rem;
        transition: transform 0.3s, box-shadow 0.3s;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }
      .card:hover:not(.locked) {
        transform: translateY(-8px) scale(1.04);
        box-shadow: 0 0 32px 0 #34d399;
        z-index: 2;
      }
      .locked {
        filter: grayscale(100%);
        opacity: 0.5;
        cursor: not-allowed;
      }
      .back-btn {
        background: rgba(6, 78, 59, 0.8);
        border: 2px solid #10b981;
        border-radius: 0.75rem;
        padding: 0.5rem 1rem;
        font-weight: bold;
        color: #a7f3d0;
        transition: background 0.2s;
      }
      .back-btn:hover {
        background: rgba(16, 185, 129, 0.9);
      }
      .firefly {
        position: absolute;
        border-radius: 999px;
        background: radial-gradient(circle, #d9fff1 60%, #34d399 100%);
        opacity: 0.7;
        pointer-events: none;
        animation: fly 8s linear infinite;
      }
      @keyframes fly {
        0% {
          transform: translateY(0) scale(1);
        }
        50% {
          transform: translateY(-30px) scale(1.2);
        }
        100% {
          transform: translateY(0) scale(1);
        }
      }
    </style>
  </head>
  <body class="min-h-screen flex flex-col">
    <div class="overlay"></div>

    <header class="relative z-10 text-center py-8">
      <!-- home button in the top right corner t navigate the home page -->
      <button
        class="back-btn act"
        onclick="window.location.href='game-index.html'"
        style="float: right; margin: 0 20px; z-index: 1000"
      >
        üó∫Ô∏è Game Menu
      </button>
      <h1 class="title text-3xl md:text-4xl text-green-200">
        üèî Mountain Quest
      </h1>
      <p class="mt-2 text-green-100">Climb with Pronunciation & Confidence</p>
      <p class="mt-1 text-green-300 text-sm">
        Current XP: <span id="xp">0</span> | Region:
        <span id="region">Mountain</span>
      </p>
      <button onclick="goBack()" class="back-btn mt-4">‚¨Ö Back to Forest</button>
    </header>

    <main
      class="relative z-10 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 px-6 max-w-6xl mx-auto mb-12"
      id="levelsGrid"
    >
      <!-- Cards will be rendered by JS -->
    </main>

    <footer class="relative z-10 text-center text-green-200 text-sm py-4">
      ¬© 2025 Mountain Quest
    </footer>

    <script>
      const PROFILE_KEY = "fqx_mountain_profile_v2";
      const FOREST_KEY = "fqx_forest_profile_v1";

      // Level data for hints
      const LEVEL_HINTS = [
        "Speak the word clearly. Use the mic or type.",
        "Tap the correct stressed syllable.",
        "Say both words, listen for differences.",
        "Try to say the twister fast and clear!",
        "Keep a natural rhythm, not too fast.",
        "End with a rising tone for questions.",
        "Express the emotion in your voice.",
        "Speak as you would in real life.",
        "Tell a short story using the pictures.",
        "Respond to the AI, keep the dialog going!",
      ];

      function loadProfile() {
        let raw = localStorage.getItem(PROFILE_KEY);
        let profile = {
          perLevelBest: Array(10).fill(0),
          unlockedLevel: 0,
          oceanUnlocked: false,
        };
        if (raw) {
          try {
            let p = JSON.parse(raw);
            if (!p.perLevelBest || p.perLevelBest.length !== 10)
              p.perLevelBest = Array(10).fill(0);
            if (typeof p.unlockedLevel !== "number") p.unlockedLevel = 0;
            if (typeof p.oceanUnlocked !== "boolean") p.oceanUnlocked = false;
            profile = p;
          } catch (e) {}
        }
        return profile;
      }
      function saveProfile(p) {
        localStorage.setItem(PROFILE_KEY, JSON.stringify(p));
      }

      function checkForestUnlock() {
        let raw = localStorage.getItem(FOREST_KEY);
        if (!raw) {
          // alert("üîí Complete the Forest Region first!");
          // window.location.href = "forest-index.html";
          return false;
        }
        let forest = JSON.parse(raw);
        if (!forest.valleyUnlocked) {
          alert("üîí You must complete the Forest Region Master Level first!");
          window.location.href = "forest-index.html";
          return false;
        }
        return true;
      }

      function updateUI() {
        if (!checkForestUnlock()) return;
        let profile = loadProfile();
        let totalXp = profile.perLevelBest.reduce((a, b) => a + b, 0);
        document.getElementById("xp").innerText = totalXp;
        document.getElementById("region").innerText = profile.oceanUnlocked
          ? "Ocean"
          : "Mountain";

        const unlockedLevel = profile.unlockedLevel || 0;

        // Render level cards dynamically for better sync
        const grid = document.getElementById("levelsGrid");
        grid.innerHTML = "";
        for (let i = 1; i <= 10; i++) {
          let locked = i > unlockedLevel + 1;
          let best = profile.perLevelBest[i - 1] || 0;
          let hint = LEVEL_HINTS[i - 1];
          grid.innerHTML += `
            <div id="level${i}" class="card ${
            locked ? "locked" : ""
          }" onclick="openLevel(${i})">
              <h2 class="font-bold text-xl text-green-200 mb-2">
                Level ${i} ‚Äì ${getLevelTitle(i)}
              </h2>
              <p class="text-green-100">${getLevelDesc(i)}</p>
              <div class="mt-2 text-green-300 text-xs">Best: ${best} XP</div>
              <div class="mt-1 text-green-200 text-xs">${hint}</div>
              ${
                locked
                  ? '<div class="absolute top-2 right-2 text-yellow-200 text-xs">üîí Locked</div>'
                  : ""
              }
            </div>
          `;
        }
        // Add fireflies for game feel
        for (let i = 0; i < 12; i++) {
          let f = document.createElement("div");
          f.className = "firefly";
          f.style.left = Math.random() * 98 + "%";
          f.style.top = Math.random() * 80 + "%";
          f.style.width = f.style.height = 4 + Math.random() * 8 + "px";
          f.style.animationDelay = Math.random() * 8 + "s";
          grid.appendChild(f);
        }
      }

      function getLevelTitle(i) {
        const titles = [
          "Word Pronunciation üé§",
          "Syllable Stress üé∂",
          "Minimal Pairs üéß",
          "Tongue Twisters üî•",
          "Sentence Rhythm üó£",
          "Question Intonation ‚ùì",
          "Expressive Reading üé≠",
          "Real-Life Phrases üëã",
          "Storytelling üìñ",
          "Summit Boss üåü",
        ];
        return titles[i - 1] || "";
      }
      function getLevelDesc(i) {
        const descs = [
          "Speak simple words clearly.",
          "Stress correct syllables.",
          "Ship vs Sheep challenge.",
          "Say fast without mistakes.",
          "Match natural rhythm.",
          "Rising tone practice.",
          "Read with emotions.",
          "Speak daily phrases naturally.",
          "Tell short fluent stories.",
          "Full speaking conversation.",
        ];
        return descs[i - 1] || "";
      }

      function openLevel(n) {
        let profile = loadProfile();
        let unlockedLevel = profile.unlockedLevel || 0;
        if (n > unlockedLevel + 1) {
          alert("üîí Level is locked. Score at least 28 XP in previous level!");
          return;
        }
        window.location.href = `mountain-levels.html?level=${n}`;
      }

      function goBack() {
        window.location.href = "forest-index.html";
      }

      updateUI();
    </script>
  </body>
</html>
